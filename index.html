<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exercise Tracker</title>
    <script src="https://unpkg.com/vue"></script>

    <script>
        const WEEK = 7*24*60*60*1000;
        
        Vue.component('workout-app', {
            props: ['log', ],
            template: `
                <div>
                    <p>Hello</p>
                    <stats v-bind:log="log"></stats>
                    <workout-log v-bind:log="log"></workout-log>
                </div>
            `,
        });

        Vue.component('stats', {
            props: ['log', ],
            computed: {
                logPastWeek: function() { return this.log.filter(({date}) => (Date.now() - date) <= WEEK); },
                durationPastWeek: function() { return this.logPastWeek.reduce((total, {duration})=>total+duration, 0); },
                oldestEntryPastWeek: function() { return this.logPastWeek.reverse()[0]; },
                nextChange: function() { return new Date(this.oldestEntryPastWeek.date - -WEEK); },
                // hack to add to a date
            },
            template: `
                <div>
                    <p>Entries: {{log.length}}</p>
                    <p>Entries past week: {{logPastWeek.length}}</p>
                    <p>Duration past week: {{durationPastWeek}}</p>
                    <p>Next change: {{nextChange}}</p>
                    <p>Duration after next change: {{durationPastWeek - oldestEntryPastWeek.duration}}</p>
                </div>
            `,
        });

        Vue.component('workout-log', {
            props: ['log'],
            template: `
                <section>
                    <h2>Workout log:</h2>
                    Entries: {{log.length}}
                    <table>
                        <tr v-for="entry in log">
                            <!--<td>{{entry}}</td>-->
                            <td>{{entry.date}}</td>
                            <td>{{entry.duration}}</td>
                        </tr>
                    </table>
                </section>
            `,
        });


    </script>
</head>
<body>
<!--
<stats>
    <past-week> Minutes in the past week </past-week>
    <next-change> Next change: when and how much </next-change>
</stats>
<add-workout> Add new: how much and when (now or specify date) </add-workout>
<workout-log> Log </workout-log>
data service

Manifest
Service worker
Firebase
-->

<workout-app v-bind:log="log"></workout-app>

<script>
    const app = new Vue({
        el: `workout-app`,
        data: {
            log2: [ 123, `abc`, true, Math, Math.random, ],
            log: [
                { date: new Date(), duration: 10 },
                { date: new Date(Date.now() - 86400000), duration: 10 },
                { date: new Date(Date.now() - 86400000*2), duration: 10 },
                { date: new Date(Date.now() - 86400000*4), duration: 10 },
                { date: new Date(Date.now() - 86400000*5), duration: 10 },
                { date: new Date(Date.now() - 86400000*6), duration: 10 },
                { date: new Date(Date.now() - 86400000*7), duration: 10 },
                { date: new Date(Date.now() - 86400000*8), duration: 10 },
                { date: new Date(Date.now() - 86400000*3), duration: 10 },
            ].sort((entry1, entry2) => entry2.date-entry1.date),
        },
        methods: {
        },
    });
</script>
</body>
</html>